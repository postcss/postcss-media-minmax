"use strict";var e=require("@csstools/css-parser-algorithms"),i=require("@csstools/css-tokenizer"),n=require("@csstools/media-query-list-parser"),t=require("@csstools/css-calc");const a=/[A-Z]/g;const r={width:"px",height:"px","device-width":"px","device-height":"px","aspect-ratio":"","device-aspect-ratio":"",color:"","color-index":"",monochrome:"",resolution:"dpi"},o={width:!1,height:!1,"device-width":!1,"device-height":!1,"aspect-ratio":!1,"device-aspect-ratio":!1,color:!0,"color-index":!0,monochrome:!0,resolution:"dpi"};function s(e){return e===n.MediaFeatureLT.LT||e===n.MediaFeatureLT.LT_OR_EQ?"max-":e===n.MediaFeatureGT.GT||e===n.MediaFeatureGT.GT_OR_EQ?"min-":""}const u={">":1,"<":-1},d=.001,p=.02;function l(a,l,c,T){let v=c.before,m=c.after;if(T||(v=c.after,m=c.before),!T){const e=n.invertComparison(l);if(!1===e)return;l=e}if(l===n.MediaFeatureEQ.EQ||l===n.MediaFeatureLT.LT_OR_EQ||l===n.MediaFeatureGT.GT_OR_EQ)return Array.isArray(c.value)?n.newMediaFeaturePlain(s(l)+a,...v,...c.value.flatMap((e=>e.tokens())),...m):n.newMediaFeaturePlain(s(l)+a,...v,...c.value.tokens(),...m);let f,y,h=!1;if(Array.isArray(c.value)){if(!n.matchesRatioExactly(c.value))return;if("aspect-ratio"!==a&&"device-aspect-ratio"!==a)return;const e=n.matchesRatio(c.value);if(-1===e)return;h=!0,f=c.value[e[0]],y=[...c.value.slice(e[0]+1).flatMap((e=>e.tokens()))]}else f=c.value,y=[];const k=r[a.toLowerCase()];if(e.isFunctionNode(f)&&"calc"===f.getName().toLowerCase()){const[[r]]=t.calcFromComponentValues([[f]],{precision:5,toCanonicalUnits:!0});if(!r||!e.isTokenNode(r)||r.value[0]!==i.TokenType.Number&&r.value[0]!==i.TokenType.Percentage&&r.value[0]!==i.TokenType.Dimension||!Number.isInteger(r.value[4].value)){let e;if(void 0!==k){const n=u[l]*("px"===k?p:d);e=[i.TokenType.Dimension,`${n.toString()}${k}`,-1,-1,{value:n,unit:k,type:i.NumberType.Integer}]}else if(!0===o[a]){const n=u[l];e=[i.TokenType.Number,n.toString(),-1,-1,{value:n,type:i.NumberType.Integer}]}else if(h){const n=u[l]*d;e=[i.TokenType.Number,n.toString(),-1,-1,{value:n,type:i.NumberType.Integer}]}else{const n=u[l];e=[i.TokenType.Number,n.toString(),-1,-1,{value:n,type:i.NumberType.Integer}]}return n.newMediaFeaturePlain(s(l)+a,...v,[i.TokenType.Function,"calc(",-1,-1,{value:"calc("}],[i.TokenType.OpenParen,"(",-1,-1,void 0],...f.tokens().slice(1),[i.TokenType.Whitespace," ",-1,-1,void 0],[i.TokenType.Delim,"+",-1,-1,{value:"+"}],[i.TokenType.Whitespace," ",-1,-1,void 0],e,[i.TokenType.CloseParen,")",-1,-1,void 0],...y,...m)}f=r}if(!e.isTokenNode(f))return;let M,g=f.value,w="";if(void 0!==k&&g[0]===i.TokenType.Number&&0===g[4].value)M=u[l],w=k;else if(g[0]===i.TokenType.Number&&0===g[4].value)M=u[l],w="";else if(g[0]===i.TokenType.Dimension&&0===g[4].value)M=u[l],w=g[4].unit;else if(g[0]===i.TokenType.Number&&!0===o[a])M=g[4].value+u[l];else if(g[0]===i.TokenType.Dimension&&"px"===g[4].unit&&g[4].type===i.NumberType.Integer)M=Number(Math.round(Number(g[4].value+p*u[l]+"e6"))+"e-6");else{if(g[0]!==i.TokenType.Dimension&&g[0]!==i.TokenType.Number)return;M=Number(Math.round(Number(g[4].value+d*u[l]+"e6"))+"e-6")}return w&&(g=[i.TokenType.Dimension,g[1],g[2],g[3],{value:g[4].value,unit:w,type:g[4].type}]),g[4].value=M,g[0]===i.TokenType.Dimension?g[1]=g[4].value.toString()+g[4].unit:g[1]=g[4].value.toString(),n.newMediaFeaturePlain(s(l)+a,...v,g,...y,...m)}const c=new Set(["aspect-ratio","color","color-index","device-aspect-ratio","device-height","device-width","height","horizontal-viewport-segments","monochrome","resolution","vertical-viewport-segments","width"]);function T(t){return t.map(((t,r)=>{const o=e.gatherNodeAncestry(t);t.walk((e=>{const r=e.node;if(!n.isMediaFeatureRange(r))return;const s=e.parent;if(!n.isMediaFeature(s))return;const u=r.name.getName().replace(a,(e=>String.fromCharCode(e.charCodeAt(0)+32)));if(!c.has(u))return;if(n.isMediaFeatureRangeNameValue(r)||n.isMediaFeatureRangeValueName(r)){const e=r.operatorKind();if(!1===e)return;const i=l(u,e,r.value,n.isMediaFeatureRangeNameValue(r));return void(i&&(s.feature=i.feature))}const d=o.get(s);if(!n.isMediaInParens(d))return;let p=null,T=null;{const e=r.valueOneOperatorKind();if(!1===e)return;const i=l(u,e,r.valueOne,!1);if(!i)return;e===n.MediaFeatureLT.LT||e===n.MediaFeatureLT.LT_OR_EQ?(p=i,p.before=s.before):(T=i,T.after=s.after)}{const e=r.valueTwoOperatorKind();if(!1===e)return;const i=l(u,e,r.valueTwo,!0);if(!i)return;e===n.MediaFeatureLT.LT||e===n.MediaFeatureLT.LT_OR_EQ?(T=i,T.before=s.before):(p=i,p.after=s.after)}if(!p||!T)return;const v=new n.MediaInParens(p),m=new n.MediaInParens(T),f=function(e,i){let t=e;if(!t)return;if(t=i.get(t),n.isMediaConditionListWithAnd(t))return t;if(!n.isMediaAnd(t))return;if(t=i.get(t),n.isMediaConditionListWithAnd(t))return t;return}(d,o);if(f)return f.leading===d?(f.leading=v,void(f.list=[new n.MediaAnd([[i.TokenType.Whitespace," ",-1,-1,void 0],[i.TokenType.Ident,"and",-1,-1,{value:"and"}],[i.TokenType.Whitespace," ",-1,-1,void 0]],m),...f.list])):void f.list.splice(f.indexOf(o.get(d)),1,new n.MediaAnd([[i.TokenType.Whitespace," ",-1,-1,void 0],[i.TokenType.Ident,"and",-1,-1,{value:"and"}],[i.TokenType.Whitespace," ",-1,-1,void 0]],v),new n.MediaAnd([[i.TokenType.Whitespace," ",-1,-1,void 0],[i.TokenType.Ident,"and",-1,-1,{value:"and"}],[i.TokenType.Whitespace," ",-1,-1,void 0]],m));const y=new n.MediaConditionListWithAnd(v,[new n.MediaAnd([[i.TokenType.Whitespace," ",-1,-1,void 0],[i.TokenType.Ident,"and",-1,-1,{value:"and"}],[i.TokenType.Whitespace," ",-1,-1,void 0]],m)],[[i.TokenType.Whitespace," ",-1,-1,void 0]]),h=function(e,i,t){let a=e;if(!a)return;if(a=t.get(a),!n.isMediaCondition(a))return;const r=a;if(a=t.get(a),!n.isMediaQuery(a))return;if(a!==i)return;return r}(d,t,o);h?h.media=y:d.media=new n.MediaCondition(new n.MediaInParens(new n.MediaCondition(y),[[i.TokenType.Whitespace," ",-1,-1,void 0],[i.TokenType.OpenParen,"(",-1,-1,void 0]],[[i.TokenType.CloseParen,")",-1,-1,void 0]]))}));const s=t.tokens();return i.stringify(...s.filter(((e,n)=>(0!==n||0!==r||e[0]!==i.TokenType.Whitespace)&&(e[0]!==i.TokenType.Whitespace||!s[n+1]||s[n+1][0]!==i.TokenType.Whitespace))))})).join(",")}const v=()=>({postcssPlugin:"postcss-media-minmax",AtRule:{media:e=>{if(!(e.params.includes("<")||e.params.includes(">")||e.params.includes("=")))return;const i=T(n.parse(e.params,{preserveInvalidMediaQueries:!0,onParseError:()=>{throw e.error(`Unable to parse media query "${e.params}"`)}}));e.params!==i&&(e.params=i)},"custom-media":e=>{if(!(e.params.includes("<")||e.params.includes(">")||e.params.includes("=")))return;const i=n.parseCustomMedia(e.params,{preserveInvalidMediaQueries:!0,onParseError:()=>{throw e.error(`Unable to parse media query "${e.params}"`)}});if(!i)return;if(!i.hasMediaQueryList())return;const t=i.mediaQueryList.map((e=>e.toString())).join(","),a=T(i.mediaQueryList);t!==a&&(e.params=e.params.replace(t," "+a))}}});v.postcss=!0,module.exports=v;
