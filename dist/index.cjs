"use strict";var e=require("@csstools/css-parser-algorithms"),n=require("@csstools/css-tokenizer"),i=require("@csstools/media-query-list-parser");const t={width:"px",height:"px","device-width":"px","device-height":"px","aspect-ratio":"","device-aspect-ratio":"",color:"","color-index":"",monochrome:"",resolution:"dpi"};function a(e){return e===i.MediaFeatureLT.LT||e===i.MediaFeatureLT.LT_OR_EQ?"max-":e===i.MediaFeatureGT.GT||e===i.MediaFeatureGT.GT_OR_EQ?"min-":""}const r={">":1,"<":-1};function o(o,s,u,d){let p,l=u.before,c=u.after;if(d||(l=u.after,c=u.before),!d){const e=i.invertComparison(s);if(!1===e)return;s=e}if(s===i.MediaFeatureEQ.EQ||s===i.MediaFeatureLT.LT_OR_EQ||s===i.MediaFeatureGT.GT_OR_EQ)return Array.isArray(u.value)?i.newMediaFeaturePlain(a(s)+o,...l,...u.value.flatMap((e=>e.tokens())),...c):i.newMediaFeaturePlain(a(s)+o,...l,...u.value.tokens(),...c);if(!Array.isArray(u.value)||!i.matchesRatioExactly(u.value)){if(p=Array.isArray(u.value)?u.value.find((n=>e.isFunctionNode(n)||e.isTokenNode(n))):u.value,e.isFunctionNode(p)&&"calc"===p.nameTokenValue().toLowerCase()){let e;if(t[o.toLowerCase()]){const i=r[s],a=t[o.toLowerCase()];e=[n.TokenType.Dimension,`${i.toString()}${a}`,-1,-1,{value:i,unit:a,type:n.NumberType.Integer}]}else{const i=r[s];e=[n.TokenType.Number,i.toString(),-1,-1,{value:i,type:n.NumberType.Integer}]}return i.newMediaFeaturePlain(a(s)+o,...l,[n.TokenType.Function,"calc(",-1,-1,{value:"calc("}],[n.TokenType.OpenParen,"(",-1,-1,void 0],...p.tokens().slice(1),[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Delim,"+",-1,-1,void 0],[n.TokenType.Whitespace," ",-1,-1,void 0],e,[n.TokenType.CloseParen,")",-1,-1,void 0],...c)}if(e.isTokenNode(p)){let e,u=p.value,d=!1;if(u[0]!==n.TokenType.Dimension&&u[0]!==n.TokenType.Number||0!==u[4].value)if(u[0]===n.TokenType.Dimension&&"px"===u[4].unit&&u[4].type===n.NumberType.Integer)e=u[4].value+r[s];else{if(u[0]!==n.TokenType.Dimension&&u[0]!==n.TokenType.Number)return;e=Number(Math.round(Number(u[4].value+.001*r[s]+"e6"))+"e-6")}else e=r[s],d=t[o.toLowerCase()];return!1!==d&&(u=[n.TokenType.Dimension,u[1],u[2],u[3],{value:u[4].value,unit:d,type:u[4].type}]),u[4].value=e,u[0]===n.TokenType.Dimension?u[1]=u[4].value.toString()+u[4].unit:u[1]=u[4].value.toString(),i.newMediaFeaturePlain(a(s)+o,...l,u,...c)}}}const s=new Set(["aspect-ratio","color","color-index","device-aspect-ratio","device-height","device-width","height","horizontal-viewport-segments","monochrome","resolution","vertical-viewport-segments","width"]);function u(t){return i.parse(t,{preserveInvalidMediaQueries:!0,onParseError:()=>{throw new Error(`Unable to parse media query "${t}"`)}}).map((t=>{const a=e.gatherNodeAncestry(t);return t.walk((e=>{const r=e.node;if(!i.isMediaFeatureRange(r))return;const u=e.parent;if(!i.isMediaFeature(u))return;const d=r.name.getName();if(!s.has(d.toLowerCase()))return;if(i.isMediaFeatureRangeNameValue(r)||i.isMediaFeatureRangeValueName(r)){const e=r.operatorKind();if(!1===e)return;const n=o(d,e,r.value,i.isMediaFeatureRangeNameValue(r));return void(n&&(u.feature=n.feature))}const p=a.get(u);if(!i.isMediaInParens(p))return;let l=null,c=null;{const e=r.valueOneOperatorKind();if(!1===e)return;const n=o(d,e,r.valueOne,!1);if(!n)return;l=n}{const e=r.valueTwoOperatorKind();if(!1===e)return;const n=o(d,e,r.valueTwo,!0);if(!n)return;c=n}const T=new i.MediaInParens(l),v=new i.MediaInParens(c),y=function(e,n){let t=e;if(!t)return;if(t=n.get(t),i.isMediaConditionListWithAnd(t))return t;if(!i.isMediaAnd(t))return;if(t=n.get(t),i.isMediaConditionListWithAnd(t))return t;return}(p,a);if(y)return y.leading===p?(y.leading=T,void(y.list=[new i.MediaAnd([[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Ident,"and",-1,-1,{value:"and"}],[n.TokenType.Whitespace," ",-1,-1,void 0]],v),...y.list])):void y.list.splice(y.indexOf(a.get(p)),1,new i.MediaAnd([[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Ident,"and",-1,-1,{value:"and"}],[n.TokenType.Whitespace," ",-1,-1,void 0]],T),new i.MediaAnd([[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Ident,"and",-1,-1,{value:"and"}],[n.TokenType.Whitespace," ",-1,-1,void 0]],v));const m=new i.MediaConditionListWithAnd(T,[new i.MediaAnd([[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Ident,"and",-1,-1,{value:"and"}],[n.TokenType.Whitespace," ",-1,-1,void 0]],v)],[[n.TokenType.Whitespace," ",-1,-1,void 0]]),f=function(e,n,t){let a=e;if(!a)return;if(a=t.get(a),!i.isMediaCondition(a))return;const r=a;if(a=t.get(a),!i.isMediaQuery(a))return;if(a!==n)return;return r}(p,t,a);f?f.media=m:p.media=new i.MediaCondition(new i.MediaInParens(new i.MediaCondition(m),[[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.OpenParen,"(",-1,-1,void 0]],[[n.TokenType.CloseParen,")",-1,-1,void 0]]))})),t.toString()})).join(",")}const d=e=>{const n=Object.assign({preserve:!1},e);return{postcssPlugin:"postcss-media-minmax",AtRule:{media:e=>{if(!(e.params.includes("<")||e.params.includes(">")||e.params.includes("=")))return;const i=u(e.params);e.params!==i&&(e.cloneBefore({params:i}),n.preserve||e.remove())}}}};d.postcss=!0,module.exports=d;
