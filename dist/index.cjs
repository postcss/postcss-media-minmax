"use strict";var e=require("@csstools/css-parser-algorithms"),n=require("@csstools/css-tokenizer"),i=require("@csstools/media-query-list-parser");const t={width:"px",height:"px","device-width":"px","device-height":"px","aspect-ratio":"","device-aspect-ratio":"",color:"","color-index":"",monochrome:"",resolution:"dpi"};function r(e){return e===i.MediaFeatureLT.LT||e===i.MediaFeatureLT.LT_OR_EQ?"max-":e===i.MediaFeatureGT.GT||e===i.MediaFeatureGT.GT_OR_EQ?"min-":""}const a={">":1,"<":-1};function o(o,s,u,d){if(!d){const e=i.invertComparison(s);if(!1===e)return;s=e}if(s===i.MediaFeatureEQ.EQ||s===i.MediaFeatureLT.LT_OR_EQ||s===i.MediaFeatureGT.GT_OR_EQ){return i.newMediaFeaturePlain(r(s)+o,...u.tokens())}if(Array.isArray(u.value)&&i.matchesRatioExactly(u.value))return;let p;if(p=Array.isArray(u.value)?u.value.find((n=>e.isFunctionNode(n)||e.isTokenNode(n))):u.value,e.isFunctionNode(p)&&"calc"===p.nameTokenValue().toLowerCase()){let e;if(t[o.toLowerCase()]){const i=a[s],r=t[o.toLowerCase()];e=[n.TokenType.Dimension,`${i.toString()}${r}`,-1,-1,{value:i,unit:r,type:n.NumberType.Integer}]}else{const i=a[s];e=[n.TokenType.Number,i.toString(),-1,-1,{value:i,type:n.NumberType.Integer}]}return i.newMediaFeaturePlain(r(s)+o,[n.TokenType.Function,"calc(",-1,-1,{value:"calc("}],[n.TokenType.OpenParen,"(",-1,-1,void 0],...p.tokens().slice(1),[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Delim,"+",-1,-1,void 0],[n.TokenType.Whitespace," ",-1,-1,void 0],e,[n.TokenType.CloseParen,")",-1,-1,void 0])}if(e.isTokenNode(p)){let e,u=p.value,d=!1;if(u[0]!==n.TokenType.Dimension&&u[0]!==n.TokenType.Number||0!==u[4].value)if(u[0]===n.TokenType.Dimension&&"px"===u[4].unit&&u[4].type===n.NumberType.Integer)e=u[4].value+a[s];else{if(u[0]!==n.TokenType.Dimension&&u[0]!==n.TokenType.Number)return;e=Number(Math.round(Number(u[4].value+.001*a[s]+"e6"))+"e-6")}else e=a[s],d=t[o.toLowerCase()];!1!==d&&(u=[n.TokenType.Dimension,u[1],u[2],u[3],{value:u[4].value,unit:d,type:u[4].type}]),u[4].value=e,u[0]===n.TokenType.Dimension?u[1]=u[4].value.toString()+u[4].unit:u[1]=u[4].value.toString();return i.newMediaFeaturePlain(r(s)+o,u)}}const s=new Set(["aspect-ratio","color","color-index","device-aspect-ratio","device-height","device-width","height","horizontal-viewport-segments","monochrome","resolution","vertical-viewport-segments","width"]);function u(t){return i.parse(t,{preserveInvalidMediaQueries:!0,onParseError:()=>{throw new Error(`Unable to parse media query "${t}"`)}}).map((t=>{const r=e.gatherNodeAncestry(t);return t.walk((e=>{const a=e.node;if(!i.isMediaFeatureRange(a))return;const u=e.parent;if(!i.isMediaFeature(u))return;const d=a.name.getName();if(!s.has(d.toLowerCase()))return;if(i.isMediaFeatureRangeNameValue(a)||i.isMediaFeatureRangeValueName(a)){const e=a.operatorKind();if(!1===e)return;const n=o(d,e,a.value,i.isMediaFeatureRangeNameValue(a));return void(n&&(u.feature=n.feature))}const p=r.get(u);if(!i.isMediaInParens(p))return;let c=null,l=null;{const e=a.valueOneOperatorKind();if(!1===e)return;const n=o(d,e,a.valueOne,!1);if(!n)return;c=n}{const e=a.valueTwoOperatorKind();if(!1===e)return;const n=o(d,e,a.valueTwo,!0);if(!n)return;l=n}const T=new i.MediaInParens(c),v=new i.MediaInParens(l),m=function(e,n){let t=e;if(!t)return;if(t=n.get(t),i.isMediaConditionListWithAnd(t))return t;if(t=n.get(t),!i.isMediaAnd(t))return;if(t=n.get(t),i.isMediaConditionListWithAnd(t))return t;return}(p,r);if(m)return m.leading===p?(m.leading=T,void(m.list=[new i.MediaAnd([[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Ident,"and",-1,-1,{value:"and"}],[n.TokenType.Whitespace," ",-1,-1,void 0]],v),...m.list])):void m.list.splice(m.indexOf(r.get(p)),1,new i.MediaAnd([[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Ident,"and",-1,-1,{value:"and"}],[n.TokenType.Whitespace," ",-1,-1,void 0]],T),new i.MediaAnd([[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Ident,"and",-1,-1,{value:"and"}],[n.TokenType.Whitespace," ",-1,-1,void 0]],v));const y=new i.MediaConditionListWithAnd(T,[new i.MediaAnd([[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Ident,"and",-1,-1,{value:"and"}],[n.TokenType.Whitespace," ",-1,-1,void 0]],v)],[[n.TokenType.Whitespace," ",-1,-1,void 0]]),f=function(e,n,t){let r=e;if(!r)return;if(r=t.get(r),!i.isMediaCondition(r))return;const a=r;if(r=t.get(r),!i.isMediaQuery(r))return;if(r!==n)return;return a}(p,t,r);f?f.media=y:p.media=new i.MediaCondition(new i.MediaInParens(new i.MediaCondition(y),[[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.OpenParen,"(",-1,-1,void 0]],[[n.TokenType.CloseParen,")",-1,-1,void 0]]))})),t.toString()})).join(",")}const d=e=>{const n=Object.assign({preserve:!1},e);return{postcssPlugin:"postcss-media-minmax",AtRule:{media:e=>{if(!(e.params.includes("<")||e.params.includes(">")||e.params.includes("=")))return;const i=u(e.params);e.params!==i&&(e.cloneBefore({params:i}),n.preserve||e.remove())}}}};d.postcss=!0,module.exports=d;
