"use strict";var e=require("@csstools/css-parser-algorithms"),i=require("@csstools/css-tokenizer"),n=require("@csstools/media-query-list-parser");const a={width:"px",height:"px","device-width":"px","device-height":"px","aspect-ratio":"","device-aspect-ratio":"",color:"","color-index":"",monochrome:"",resolution:"dpi"};function r(e){return e===n.MediaFeatureLT.LT||e===n.MediaFeatureLT.LT_OR_EQ?"max-":e===n.MediaFeatureGT.GT||e===n.MediaFeatureGT.GT_OR_EQ?"min-":""}const t={">":1,"<":-1};function o(o,s,u,d){let p,T=u.before,c=u.after;if(d||(T=u.after,c=u.before),!d){const e=n.invertComparison(s);if(!1===e)return;s=e}if(s===n.MediaFeatureEQ.EQ||s===n.MediaFeatureLT.LT_OR_EQ||s===n.MediaFeatureGT.GT_OR_EQ)return Array.isArray(u.value)?n.newMediaFeaturePlain(r(s)+o,...T,...u.value.flatMap((e=>e.tokens())),...c):n.newMediaFeaturePlain(r(s)+o,...T,...u.value.tokens(),...c);if(!Array.isArray(u.value)||!n.matchesRatioExactly(u.value)){if(p=Array.isArray(u.value)?u.value.find((i=>e.isFunctionNode(i)||e.isTokenNode(i))):u.value,e.isFunctionNode(p)&&"calc"===p.getName().toLowerCase()){let e;if(a[o.toLowerCase()]){const n=t[s],r=a[o.toLowerCase()];e=[i.TokenType.Dimension,`${n.toString()}${r}`,-1,-1,{value:n,unit:r,type:i.NumberType.Integer}]}else{const n=t[s];e=[i.TokenType.Number,n.toString(),-1,-1,{value:n,type:i.NumberType.Integer}]}return n.newMediaFeaturePlain(r(s)+o,...T,[i.TokenType.Function,"calc(",-1,-1,{value:"calc("}],[i.TokenType.OpenParen,"(",-1,-1,void 0],...p.tokens().slice(1),[i.TokenType.Whitespace," ",-1,-1,void 0],[i.TokenType.Delim,"+",-1,-1,void 0],[i.TokenType.Whitespace," ",-1,-1,void 0],e,[i.TokenType.CloseParen,")",-1,-1,void 0],...c)}if(e.isTokenNode(p)){let e,u=p.value,d=!1;if(u[0]!==i.TokenType.Dimension&&u[0]!==i.TokenType.Number||0!==u[4].value)if(u[0]===i.TokenType.Dimension&&"px"===u[4].unit&&u[4].type===i.NumberType.Integer)e=u[4].value+t[s];else{if(u[0]!==i.TokenType.Dimension&&u[0]!==i.TokenType.Number)return;e=Number(Math.round(Number(u[4].value+.001*t[s]+"e6"))+"e-6")}else e=t[s],d=a[o.toLowerCase()];return!1!==d&&(u=[i.TokenType.Dimension,u[1],u[2],u[3],{value:u[4].value,unit:d,type:u[4].type}]),u[4].value=e,u[0]===i.TokenType.Dimension?u[1]=u[4].value.toString()+u[4].unit:u[1]=u[4].value.toString(),n.newMediaFeaturePlain(r(s)+o,...T,u,...c)}}}const s=new Set(["aspect-ratio","color","color-index","device-aspect-ratio","device-height","device-width","height","horizontal-viewport-segments","monochrome","resolution","vertical-viewport-segments","width"]);function u(a){return a.map(((a,r)=>{const t=e.gatherNodeAncestry(a);a.walk((e=>{const r=e.node;if(!n.isMediaFeatureRange(r))return;const u=e.parent;if(!n.isMediaFeature(u))return;const d=r.name.getName();if(!s.has(d.toLowerCase()))return;if(n.isMediaFeatureRangeNameValue(r)||n.isMediaFeatureRangeValueName(r)){const e=r.operatorKind();if(!1===e)return;const i=o(d,e,r.value,n.isMediaFeatureRangeNameValue(r));return void(i&&(u.feature=i.feature))}const p=t.get(u);if(!n.isMediaInParens(p))return;let T=null,c=null;{const e=r.valueOneOperatorKind();if(!1===e)return;const i=o(d,e,r.valueOne,!1);if(!i)return;e===n.MediaFeatureLT.LT||e===n.MediaFeatureLT.LT_OR_EQ?(T=i,T.before=u.before):(c=i,c.after=u.after)}{const e=r.valueTwoOperatorKind();if(!1===e)return;const i=o(d,e,r.valueTwo,!0);if(!i)return;e===n.MediaFeatureLT.LT||e===n.MediaFeatureLT.LT_OR_EQ?(c=i,c.before=u.before):(T=i,T.after=u.after)}const l=new n.MediaInParens(T),v=new n.MediaInParens(c),m=function(e,i){let a=e;if(!a)return;if(a=i.get(a),n.isMediaConditionListWithAnd(a))return a;if(!n.isMediaAnd(a))return;if(a=i.get(a),n.isMediaConditionListWithAnd(a))return a;return}(p,t);if(m)return m.leading===p?(m.leading=l,void(m.list=[new n.MediaAnd([[i.TokenType.Whitespace," ",-1,-1,void 0],[i.TokenType.Ident,"and",-1,-1,{value:"and"}],[i.TokenType.Whitespace," ",-1,-1,void 0]],v),...m.list])):void m.list.splice(m.indexOf(t.get(p)),1,new n.MediaAnd([[i.TokenType.Whitespace," ",-1,-1,void 0],[i.TokenType.Ident,"and",-1,-1,{value:"and"}],[i.TokenType.Whitespace," ",-1,-1,void 0]],l),new n.MediaAnd([[i.TokenType.Whitespace," ",-1,-1,void 0],[i.TokenType.Ident,"and",-1,-1,{value:"and"}],[i.TokenType.Whitespace," ",-1,-1,void 0]],v));const y=new n.MediaConditionListWithAnd(l,[new n.MediaAnd([[i.TokenType.Whitespace," ",-1,-1,void 0],[i.TokenType.Ident,"and",-1,-1,{value:"and"}],[i.TokenType.Whitespace," ",-1,-1,void 0]],v)],[[i.TokenType.Whitespace," ",-1,-1,void 0]]),f=function(e,i,a){let r=e;if(!r)return;if(r=a.get(r),!n.isMediaCondition(r))return;const t=r;if(r=a.get(r),!n.isMediaQuery(r))return;if(r!==i)return;return t}(p,a,t);f?f.media=y:p.media=new n.MediaCondition(new n.MediaInParens(new n.MediaCondition(y),[[i.TokenType.Whitespace," ",-1,-1,void 0],[i.TokenType.OpenParen,"(",-1,-1,void 0]],[[i.TokenType.CloseParen,")",-1,-1,void 0]]))}));const u=a.tokens();return i.stringify(...u.filter(((e,n)=>(0!==n||0!==r||e[0]!==i.TokenType.Whitespace)&&(e[0]!==i.TokenType.Whitespace||!u[n+1]||u[n+1][0]!==i.TokenType.Whitespace))))})).join(",")}const d=()=>({postcssPlugin:"postcss-media-minmax",AtRule:{media:e=>{if(!(e.params.includes("<")||e.params.includes(">")||e.params.includes("=")))return;const i=u(n.parse(e.params,{preserveInvalidMediaQueries:!0,onParseError:()=>{throw e.error(`Unable to parse media query "${e.params}"`)}}));e.params!==i&&(e.params=i)},"custom-media":e=>{if(!(e.params.includes("<")||e.params.includes(">")||e.params.includes("=")))return;const i=n.parseCustomMedia(e.params,{preserveInvalidMediaQueries:!0,onParseError:()=>{throw e.error(`Unable to parse media query "${e.params}"`)}});if(!i)return;if(!i.hasMediaQueryList())return;const a=i.mediaQueryList.map((e=>e.toString())).join(","),r=u(i.mediaQueryList);a!==r&&(e.params=e.params.replace(a," "+r))}}});d.postcss=!0,module.exports=d;
