"use strict";var e=require("@csstools/css-parser-algorithms"),n=require("@csstools/css-tokenizer"),i=require("@csstools/media-query-list-parser");const t={width:"px",height:"px","device-width":"px","device-height":"px","aspect-ratio":"","device-aspect-ratio":"",color:"","color-index":"",monochrome:"",resolution:"dpi"};function a(e){return e===i.MediaFeatureLT.LT||e===i.MediaFeatureLT.LT_OR_EQ?"max-":e===i.MediaFeatureGT.GT||e===i.MediaFeatureGT.GT_OR_EQ?"min-":""}const r={">":1,"<":-1};function o(o,s,u,d){let p,T=u.before,c=u.after;if(d||(T=u.after,c=u.before),!d){const e=i.invertComparison(s);if(!1===e)return;s=e}if(s===i.MediaFeatureEQ.EQ||s===i.MediaFeatureLT.LT_OR_EQ||s===i.MediaFeatureGT.GT_OR_EQ)return Array.isArray(u.value)?i.newMediaFeaturePlain(a(s)+o,...T,...u.value.flatMap((e=>e.tokens())),...c):i.newMediaFeaturePlain(a(s)+o,...T,...u.value.tokens(),...c);if(!Array.isArray(u.value)||!i.matchesRatioExactly(u.value)){if(p=Array.isArray(u.value)?u.value.find((n=>e.isFunctionNode(n)||e.isTokenNode(n))):u.value,e.isFunctionNode(p)&&"calc"===p.nameTokenValue().toLowerCase()){let e;if(t[o.toLowerCase()]){const i=r[s],a=t[o.toLowerCase()];e=[n.TokenType.Dimension,`${i.toString()}${a}`,-1,-1,{value:i,unit:a,type:n.NumberType.Integer}]}else{const i=r[s];e=[n.TokenType.Number,i.toString(),-1,-1,{value:i,type:n.NumberType.Integer}]}return i.newMediaFeaturePlain(a(s)+o,...T,[n.TokenType.Function,"calc(",-1,-1,{value:"calc("}],[n.TokenType.OpenParen,"(",-1,-1,void 0],...p.tokens().slice(1),[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Delim,"+",-1,-1,void 0],[n.TokenType.Whitespace," ",-1,-1,void 0],e,[n.TokenType.CloseParen,")",-1,-1,void 0],...c)}if(e.isTokenNode(p)){let e,u=p.value,d=!1;if(u[0]!==n.TokenType.Dimension&&u[0]!==n.TokenType.Number||0!==u[4].value)if(u[0]===n.TokenType.Dimension&&"px"===u[4].unit&&u[4].type===n.NumberType.Integer)e=u[4].value+r[s];else{if(u[0]!==n.TokenType.Dimension&&u[0]!==n.TokenType.Number)return;e=Number(Math.round(Number(u[4].value+.001*r[s]+"e6"))+"e-6")}else e=r[s],d=t[o.toLowerCase()];return!1!==d&&(u=[n.TokenType.Dimension,u[1],u[2],u[3],{value:u[4].value,unit:d,type:u[4].type}]),u[4].value=e,u[0]===n.TokenType.Dimension?u[1]=u[4].value.toString()+u[4].unit:u[1]=u[4].value.toString(),i.newMediaFeaturePlain(a(s)+o,...T,u,...c)}}}const s=new Set(["aspect-ratio","color","color-index","device-aspect-ratio","device-height","device-width","height","horizontal-viewport-segments","monochrome","resolution","vertical-viewport-segments","width"]);function u(t){return i.parse(t,{preserveInvalidMediaQueries:!0,onParseError:()=>{throw new Error(`Unable to parse media query "${t}"`)}}).map(((t,a)=>{const r=e.gatherNodeAncestry(t);t.walk((e=>{const a=e.node;if(!i.isMediaFeatureRange(a))return;const u=e.parent;if(!i.isMediaFeature(u))return;const d=a.name.getName();if(!s.has(d.toLowerCase()))return;if(i.isMediaFeatureRangeNameValue(a)||i.isMediaFeatureRangeValueName(a)){const e=a.operatorKind();if(!1===e)return;const n=o(d,e,a.value,i.isMediaFeatureRangeNameValue(a));return void(n&&(u.feature=n.feature))}const p=r.get(u);if(!i.isMediaInParens(p))return;let T=null,c=null;{const e=a.valueOneOperatorKind();if(!1===e)return;const n=o(d,e,a.valueOne,!1);if(!n)return;e===i.MediaFeatureLT.LT||e===i.MediaFeatureLT.LT_OR_EQ?T=n:c=n}{const e=a.valueTwoOperatorKind();if(!1===e)return;const n=o(d,e,a.valueTwo,!0);if(!n)return;e===i.MediaFeatureLT.LT||e===i.MediaFeatureLT.LT_OR_EQ?c=n:T=n}const l=new i.MediaInParens(T),v=new i.MediaInParens(c),y=function(e,n){let t=e;if(!t)return;if(t=n.get(t),i.isMediaConditionListWithAnd(t))return t;if(!i.isMediaAnd(t))return;if(t=n.get(t),i.isMediaConditionListWithAnd(t))return t;return}(p,r);if(y)return y.leading===p?(y.leading=l,void(y.list=[new i.MediaAnd([[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Ident,"and",-1,-1,{value:"and"}],[n.TokenType.Whitespace," ",-1,-1,void 0]],v),...y.list])):void y.list.splice(y.indexOf(r.get(p)),1,new i.MediaAnd([[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Ident,"and",-1,-1,{value:"and"}],[n.TokenType.Whitespace," ",-1,-1,void 0]],l),new i.MediaAnd([[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Ident,"and",-1,-1,{value:"and"}],[n.TokenType.Whitespace," ",-1,-1,void 0]],v));const m=new i.MediaConditionListWithAnd(l,[new i.MediaAnd([[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.Ident,"and",-1,-1,{value:"and"}],[n.TokenType.Whitespace," ",-1,-1,void 0]],v)],[[n.TokenType.Whitespace," ",-1,-1,void 0]]),f=function(e,n,t){let a=e;if(!a)return;if(a=t.get(a),!i.isMediaCondition(a))return;const r=a;if(a=t.get(a),!i.isMediaQuery(a))return;if(a!==n)return;return r}(p,t,r);f?f.media=m:p.media=new i.MediaCondition(new i.MediaInParens(new i.MediaCondition(m),[[n.TokenType.Whitespace," ",-1,-1,void 0],[n.TokenType.OpenParen,"(",-1,-1,void 0]],[[n.TokenType.CloseParen,")",-1,-1,void 0]]))}));const u=t.tokens();return n.stringify(...u.filter(((e,i)=>(0!==i||0!==a||e[0]!==n.TokenType.Whitespace)&&(e[0]!==n.TokenType.Whitespace||!u[i+1]||u[i+1][0]!==n.TokenType.Whitespace))))})).join(",")}const d=e=>{const n=Object.assign({preserve:!1},e);return{postcssPlugin:"postcss-media-minmax",AtRule:{media:e=>{if(!(e.params.includes("<")||e.params.includes(">")||e.params.includes("=")))return;const i=u(e.params);e.params!==i&&(e.cloneBefore({params:i}),n.preserve||e.remove())}}}};d.postcss=!0,module.exports=d;
